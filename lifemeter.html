<!DOCTYPE html>
<html>
	<head>
		<!--[if lte IE 8]><script type="text/javascript" src="excanvas.js"></script><![endif]-->
		
		<script type="text/javascript" src="life-expectancy-data.js"></script>
		<script type="text/javascript" src="lifemeter.js"></script> <!-- data -->
		<script type="text/javascript" src="canvas-util.js"></script> <!-- graphics mapulation -->
		<script type="text/javascript" src="default-style.js"></script> <!-- this game's style -->
		
		<script type="text/javascript">
			window.onload = function() {
			
				lifemeter.init({
					month: 3,
					day: 12,
					year: 2016,
					data: data.male
				});
				
				lifemeter.calculate();
				
				lifemeter.toLog();
				
				// build canvas 
				var canvas = document.getElementById('lifemeter-canvas');
				
				if(canvas.getContext) {
					canvas.width = 300;
					canvas.height = 300;
					var ctx = canvas.getContext('2d');
					
					// todo: preload images http://www.html5canvastutorials.com/tutorials/html5-canvas-image-loader/
					var bg = new Image();
					bg.addEventListener('load', function() {
						ctx.drawImage(bg, 0, 0);
					}, false);
					bg.src = 'bg.png';
					
					var meterBg = new Image();
					meterBg.addEventListener('load', function() {
						ctx.drawImage(meterBg, 10, 10);
					}, false);
					meterBg.src = 'meterbg.png';
					
					var meterBar = new Image();
					meterBar.addEventListener('load', function() {
						var barHeight = 4;
						var barBottom = 117;
						var numBarsFullHealth = 28;
						var numBarsCurrentHealth = Math.round(numBarsFullHealth * lifemeter.results.meterValue);
						
						for(var x = 0; x < numBarsCurrentHealth; x++) {
							ctx.drawImage(meterBar, 10, barBottom - (barHeight* x));
						}

					}, false);
					meterBar.src = 'meterbar.png';
				}
				
				
			};
		</script>
		
		<style type="text/css">
			body { margin: 0; padding: 0; }
			canvas { border: 1px solid black; }
			
			.frame {
				padding: 25px;
				background: #ddd;
				border: 1px solid #777;
				width: 302px;
			}
		</style>
	</head>
	<body>
		<div class="frame"><canvas id="lifemeter-canvas"></canvas></div>
	</body>
</html>